<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="data.mapper.PlanMapper">
	<select id="getCityCode" parameterType="int" resultType="Map">
		select name as city_name, area_code, sigungu_code from city where num=#{cityNum}
	</select>
	<select id="getMyPlaceList" parameterType="Map" resultType="place">
		select * from `like`, place where `like`.place_id=place.contentid and place.city_num=#{city_num} and `check`=1 and member_num=#{member_num}
	</select>
	<insert id="insertTrip" parameterType="trip">
		insert into trip (member_num, city_num, start_date, end_date, days) 
		values (#{memberNum}, #{cityNum}, #{startDate}, #{endDate}, #{days}) 
		<selectKey resultType="int" keyProperty="num" order="AFTER">
    	select max(num) from trip
    </selectKey>
	</insert>
	<insert id="insertItinerary" parameterType="itinerary">
		insert into itinerary (trip_num, `day`, `order`, place_id) values (#{trip_num}, #{day}, #{order}, #{place_id})
	</insert>
	<select id="checkPlace" parameterType="String" resultType="int">
		select count(*) from place where contentid=#{contentid}
	</select>
	<insert id="insertPlace" parameterType="place">
		insert into place values 
		(#{city_num}, #{contentid}, #{contenttypeid}, #{title}, #{cat3}, #{addr1}, #{addr2}, #{firstimage}, #{mapx}, #{mapy})
	</insert>
	
<!--                                                -->

	<select id="getNavNum" resultType="plan">
		select * from itinerary, place where trip_num=1 and place_id=contentid group by `day` order by `day`;
	</select>

	<select id="getPlanDatas" resultType="plan">
		select * from itinerary, place where trip_num=1 and place_id=contentid order by `day`, `order`;
	</select>
</mapper>